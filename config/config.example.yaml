# ATEM ISO EDL Generator — Example Configuration
# Copy this file to config.yaml and adjust for your environment.

# ============================================================================
# ATEM Switcher Connection
# ============================================================================
atem:
  # IP address of your ATEM switcher
  host: "10.7.77.7"

  # Mix/Effect bank to monitor (0 = first M/E)
  # Most switchers have only one M/E (index 0)
  # Constellation series may have multiple
  mixEffect: 0

  # Frame offset for timestamp compensation
  # Positive values: delay timestamps (compensate for ATEM processing latency)
  # Negative values: advance timestamps
  # Typical ATEM processing delay is 1-2 frames
  # Set to 0 to disable compensation
  frameOffset: 1

  # Reconnection settings
  reconnect:
    enabled: true
    maxAttempts: 0          # 0 = infinite
    initialDelayMs: 1000
    maxDelayMs: 30000

# ============================================================================
# HyperDeck Connections
# ============================================================================
# Map each ISO recording source to a HyperDeck
# The inputMapping links ATEM inputs to HyperDeck recordings

hyperdecks:
  - name: "ISO-1"
    host: "10.7.77.21"
    port: 9993              # Default HyperDeck port
    inputMapping: 1         # ATEM input number this records
    enabled: true
    # Per-deck frame offset for recording delay compensation
    # Use this to fine-tune sync for each deck independently
    frameOffset: 0

  - name: "ISO-2"
    host: "10.7.77.22"
    port: 9993
    inputMapping: 2
    enabled: true
    frameOffset: 0

  - name: "ISO-3"
    host: "10.7.77.23"
    port: 9993
    inputMapping: 3
    enabled: true
    frameOffset: 0

  - name: "ISO-4"
    host: "10.7.77.24"
    port: 9993
    inputMapping: 4
    enabled: true
    frameOffset: 0

# ============================================================================
# Input Configuration
# ============================================================================
# Define human-readable names and EDL identifiers for each ATEM input

inputs:
  1:
    name: "Centre Wide"
    reelName: "CAM1"        # Max 8 characters for EDL compatibility
    filePrefix: "CAM1_"     # Expected filename prefix on HyperDeck

  2:
    name: "Centre MCU"
    reelName: "CAM2"
    filePrefix: "CAM2_"

  3:
    name: "Centre ECU"
    reelName: "CAM3"
    filePrefix: "CAM3_"

  4:
    name: "Steadicam"
    reelName: "CAM4"
    filePrefix: "CAM4_"

  # Graphics and other sources
  1000:
    name: "Media Player 1"
    reelName: "MP1"
    filePrefix: "GFX_"

  2001:
    name: "Color Bars"
    reelName: "BARS"
    filePrefix: null        # No recording for this source

# ============================================================================
# EDL Output Settings
# ============================================================================
edl:
  # Where to save generated EDL files
  outputDirectory: "./output"

  # Output format (currently only cmx3600 supported)
  format: "cmx3600"

  # Timeline frame rate — must match your project
  # Common values: 23.976, 24, 25, 29.97, 30, 50, 59.94, 60
  frameRate: 25

  # Drop-frame timecode (only for 29.97 and 59.94)
  dropFrame: false

  # Include extended comment lines for NLE compatibility
  # Adds: FROM CLIP NAME, SOURCE FILE, ATEM INPUT
  includeComments: true

  # Default title for EDL (can be overridden per-session)
  defaultTitle: "LIVE_PRODUCTION"

# ============================================================================
# Timecode Settings
# ============================================================================
timecode:
  # Primary timecode source:
  # - "system"    : Use system clock (simplest, may drift over long sessions)
  # - "hyperdeck" : Use RP-188 embedded in SDI from HyperDeck (recommended for accuracy)
  source: "system"

  # Frame rate for timecode — should match edl.frameRate
  frameRate: 25

  # Drop-frame timecode (only valid for 29.97 and 59.94 fps)
  dropFrame: false

  # Starting timecode for system clock mode
  # Set to "auto" to use current time of day
  # Or specify fixed start: "01:00:00:00"
  startTimecode: "auto"

  # HyperDeck timecode provider configuration
  # Required when source is "hyperdeck"
  # hyperdeck:
  #   # IP of HyperDeck receiving SDI with embedded RP-188 timecode
  #   host: "192.168.1.250"
  #   port: 9993
  #
  #   # Use protocol notifications (1.11+) for better performance
  #   useNotifications: true
  #
  #   # Polling rate when notifications unavailable (1-25 Hz)
  #   pollRateHz: 10
  #
  #   # Only accept timecode if source is SDI (not internal generator)
  #   # Enable for "real TC" with RP-188 embedded timecode
  #   requireSdiSource: true
  #
  #   # Connection and reconnection settings
  #   connectionTimeoutMs: 5000
  #   reconnect:
  #     enabled: true
  #     maxAttempts: 0        # 0 = infinite
  #     initialDelayMs: 1000
  #     maxDelayMs: 30000

  # Fallback settings — switch to system clock if primary fails
  fallback:
    enabled: true
    delayMs: 3000             # Switch after 3 seconds of failure

  # Maximum rate for timecode updates to downstream consumers (Hz)
  maxEmitRateHz: 25

# ============================================================================
# Web Interface
# ============================================================================
web:
  enabled: true
  port: 3000
  host: "0.0.0.0"           # Listen on all interfaces

  # Basic authentication (optional)
  # auth:
  #   enabled: true
  #   username: "operator"
  #   password: "changeme"

# ============================================================================
# Logging
# ============================================================================
logging:
  # Log level: "debug", "info", "warn", "error"
  level: "info"

  # Write all events to JSONL file for replay/analysis
  eventLog: true

  # Event log directory
  eventLogDirectory: "./logs"

  # Rotate logs daily
  rotateDaily: true

  # Pretty print to console (disable in production)
  prettyPrint: true

# ============================================================================
# Health Monitoring
# ============================================================================
health:
  # Health check endpoint
  enabled: true

  # Prometheus metrics endpoint
  metrics:
    enabled: true
    port: 9090

  # Watchdog — restart if no events for this duration
  watchdog:
    enabled: false
    timeoutMs: 300000       # 5 minutes
